<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.Trip.mapper.UserMapper">
	<sql id="criteria">
		<trim prefix="(" suffix=") AND " prefixOverrides="OR">
			<foreach item='type' collection='typeArr'>
				<trim prefix='OR'>
					<choose>
						<when test='type == "T".toString()'>
							title like '%'||#{keyword}||'%'
						</when>
						<when test='type == "C".toString()'>
							content like '%'||#{keyword}||'%'
						</when>
						<when test='type == "W".toString()'>
							writer like '%'||#{keyword}||'%'
						</when>
						<when test='type == "cate".toString()'>
							category like '%'||${keyword}||'%'
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>
	</sql>
	
	<!-- 회원가입 selectKey 버전 -->
	<insert id="insertSelectKey">
	
		<selectKey keyProperty="uno" order="BEFORE" resultType="Long">
			select seq_userno.nextval from dual
		</selectKey>
		
		insert into trip_user (user_no, user_Id, user_passwd, user_nick, user_email, user_num, user_zipcode, user_adr1, user_adr2, user_login_ty)
		values(#{uno}, #{userId}, #{passwd}. #{userNick}, #{email}, #{phone}, #{zipCode}, #{address1}, #{address2}, #{loginType})
	</insert>
	
	<insert id='insert'>
		insert into trip_user(user_no, user_Id, user_passwd, user_nick, user_email, user_num, user_zipcode, user_adr1, user_adr2, user_login_ty)
		values (seq_userno.nextval, #{userId}, #{passwd}, #{userNick}, #{email}, #{phone}, #{zipCode}, #{address1}, #{address2}, #{loginType})
	</insert>
	
	<!-- 회원 로그인 -->
	<select id="read" resultType="org.Trip.domain.TripUserVO">
		select * from trip_user where user_no = #{uno}
	</select>
	
	<update id="delete" parameterType='Long'>
		update trip_user set deleted_at = sysdate where user_no = #{uno}
	</update>
	
	<select id="findId" parameterType="String" resultType="org.Trip.domain.TripUserVO">
		select * from trip_user where user_id = #{userId}
	</select>
	
	<select id="getList" resultType="org.Trip.domain.TripUserVO">
		<![CDATA[
			select * from trip_user where user_no > 0
		]]>
	</select>
	
	
	<select id="loginID" resultType="org.Trip.security.UserSecurityDetails">
		select * from authorities where a_id = #{username}
	</select>
	
	<resultMap type="org.Trip.domain.TripUserVO" id="userMap">
		<id property="userId" column="user_id" />
		<result property="uno" column="user_no" />
		<result property="userId" column="user_id" />
		<result property="passwd" column="user_passwd" />
		<result property="email" column="user_email" />
		<result property="phone" column="user_num" />
		<result property="userType" column="user_num" />
		<result property="zipCode" column="user_type" />
		<result property="address1" column="user_adr1" />
		<result property="address2" column="user_adr2" />
		<result property="loginType" column="user_login_ty" />
		<result property="regDate" column="regdate" />
		
		<collection property="authList" resultMap="authMap"></collection>
	</resultMap>
	
	<resultMap type="org.Trip.domain.AuthVO" id="authMap">
		<result property="ano" column="ano" />
		<result property="userid" column="user_id" />
		<result property="auth" column="auth" />
	</resultMap>
	
	<select id="readId" resultMap="userMap">
		select u.user_id, user_passwd, user_nick, user_email, user_num, user_type, user_zipode, user_adr1, user_adr2, user_login_ty, regdate
		from 
			trip_user u left outer join user_auth a on u.user_id = a.user_id
		where u.user_id = #{userId}
	</select>
	
	
</mapper>